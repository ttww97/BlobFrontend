# Drone-SCP 部署错误修复

## 错误信息

```
tar: artifacts: Cannot mkdir: Permission denied
tar: artifacts/BlobFrontend-1.0-SNAPSHOT.war: Cannot open: No such file or directory
tar: Exiting with failure status due to previous errors
drone-scp error: Process exited with status 2
```

## 问题原因

**错误的 tar 命令：**
```bash
tar -zcf /tmp/jahPonMqBo.tar.gz artifacts/BlobFrontend-1.0-SNAPSHOT.war
```

这个命令会把 `artifacts/` 目录结构也打包进去，导致 tar 文件内容为：
```
artifacts/
└── BlobFrontend-1.0-SNAPSHOT.war
```

在远程服务器解压时，会尝试创建 `artifacts/` 目录，但用户没有权限，导致失败。

## 解决方案

**修改 tar 命令，使用 `-C` 参数：**

```bash
tar -zcf /tmp/jahPonMqBo.tar.gz -C artifacts BlobFrontend-1.0-SNAPSHOT.war
```

`-C artifacts` 会先切换到 `artifacts/` 目录，然后打包文件，这样 tar 文件只包含文件本身：
```
BlobFrontend-1.0-SNAPSHOT.war
```

## 验证方法

创建 tar 文件后，可以用以下命令验证内容：

```bash
tar -tzf /tmp/jahPonMqBo.tar.gz
```

**正确输出应该是：**
```
BlobFrontend-1.0-SNAPSHOT.war
```

**错误输出（包含目录结构）：**
```
artifacts/BlobFrontend-1.0-SNAPSHOT.war
```

## 在 Drone CI 中应用

在你的 `.drone.yml` 或 Drone CI 配置中，将 tar 命令修改为：

```yaml
- name: create-tar
  image: alpine
  commands:
    - tar -zcf /tmp/jahPonMqBo.tar.gz -C artifacts BlobFrontend-1.0-SNAPSHOT.war
    - tar -tzf /tmp/jahPonMqBo.tar.gz  # 验证内容
```

## 总结

**只需要改一个参数：**

- ❌ 错误：`tar -zcf /tmp/jahPonMqBo.tar.gz artifacts/BlobFrontend-1.0-SNAPSHOT.war`
- ✅ 正确：`tar -zcf /tmp/jahPonMqBo.tar.gz -C artifacts BlobFrontend-1.0-SNAPSHOT.war`

就这么简单！

